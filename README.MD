Easygrid
=======================

This plugin provides a convenient and agile way of defining a DataGrid



Installation
-----------------------------

    grails install-plugin easygrid



Overview
----------------------------

The issues that Easygrid tackles are:

- big learning curve for each javascript framework
- each grid resides in multiple places ( Controller, gsp ). Usually, in the controller, there's a different method for each aspect ( search, export, security, etc)
- a lot of concerns are addressed programmatically, instead of declaratively (like search, formats )
- duplicated code (javascript, gsp, controllers). Each project has to create individual mechanisms to address it.



Easygrid solves these problems by proposing a solution based on declarations & conventions.


### Features:

- custom builder - for defining the grid
- easy to mock and test: able to generate a Grid from a domain class without any custom configuration
- reloads & regenerates the grid when source code is changed
- convenient default values for grid & column properties
- predefined column types - ( sets of properties )
- define the column formatters in one place
- customizable html/javascript grid templates
- built-in support for exporting to XLS ( using the exporter plugin )



Concepts
--------------------

Basically, all aspects of a grid are defined in the Controller using the easygrid custom builder .
For each grid you need to configure the following aspects.

####Mandatory:

- datasource
- grid implementation
- columns:
    - label
    - value ( could be a property of the datasource row, or a closure )
    - formatting
    - Optional specific grid implementation properties ( that will be available in the renderer)
    - searchClosure - i case the grid support per column filtering - this closure will act as a filter ( will depend on the underlying datasource )

####Optional:

- security
- global formatting of values
- export


The plugin provides a clean separation between the model and the view ( datasource & rendering )
Currently there are implementation for 3 datasources ( GORM , list - represents a list from the session, custom - fully configurable)
and 4 grid implementations ( JqGrid, Google visualization, Datatables, static table (the one generated by scaffolding) )



Usage
-----------------------------

All grids will be defined in controllers - which must be annotated with @Easygrid.

In each annotated controller you need to define a static closure called "grids" where you define the grids which will be made available by this controller

The plugin provides a custom Builder for making the configuration more straight forward

Ex:  grid to display Authors with 4 columns: id, name, nation and birthdate

    static grids = {
        'authorGrid' {
            datasourceType 'domain'
            domainClass Author
            gridImpl 'jqgrid'
            roles 'ROLE_USER'
            columns {
                'author.id' {
                    type 'id'
                }
                'author.name.label' {
                    property 'name'
                    jqgrid {
                        editable true
                        searchClosure {params ->
                            ilike('name', "%${params.name}%")
                        }
                    }
                    export {
                        width 100
                    }
                }
                'author.nation.label' {
                    property 'nation'
                    jqgrid {
                        searchClosure {params ->
                            ilike('nation', "%${params.nation}%")
                        }
                    }
                }
                'author.age.label' {
                    value { row ->
                        use(TimeCategory) {
                            new Date().year - row.birthDate.time.year
                        }
                    }
                    jqgrid {
                        name 'age'
                        width 110
                        search false
                    }
                }
                'author.birthDate.label' {
                    property 'birthDate'
                    jqgrid {
                        width 110
                        searchClosure {params ->
                            eq('birthDate', params.birthDate)
                        }
                    }
                }
            }
        }
    }

From this simple example, you can see how we can define all aspects of the grid here.
( datasource, rendering, security, export properties, filtering )



#### Grid Implementations:

*	**classic**
        - implements the classic grails grid ( the static one generated by scaffolding )

*	**jqgrid**
        - implements [jqgrid](http://www.trirand.com/blog/)

*	**visualization**
        - implements [google visualization datatable](https://developers.google.com/chart/interactive/docs/reference#DataTable)

*	**datatables**
        - implements [datatables](http://datatables.net)

 To create your own implementation you need to:

    1) create a service
    2) create a renderer
    3) declare the service & renderer in Config

On installation of the plugin , the renderer templates for the default implementations are copied to /grails-app/views/templates.


#### Grid Datasource Types:
*	**domain**

        - the datasource is a Gorm domain class.
        - domainClass - the domain ( mandatory)
        - initialCriteria  - a filter that will be applied all the time

    For fast mock-up , grids with this type can be defined without columns, in which case these will be generated at runtime.

    The search closure is defined per column and will have to be a closure which will be used by a  GORM CriteriaBuilder


*	**list**

        - used when you have a clear list of objects (stored in the session) that must be displayed in the grid

        - attributeName - is the attribute name (in the specified context)

        - context - the context where to find the list ( defaults to session )

        - pagination will be handled by the framework


*	**custom**

        - when the list to be displayed is dynamic

        - dataProvider  - closure that returns the actual data ( must implement pagination )

         - dataCount - closure that returns the number of items


If you want to create your own datasource:

1) Create a service - which must have the following methods:
      - generateDynamicColumns() - optional - if you want to be able to generate columns
      - verifyGridConstraints(gridConfig)  - verify if the config is setup properly for this datasource impl
      - list(Map listParams = [:], filters = null) - (     * returns the list of rows
                                                           * by default will return all elements
                                                           * @param listParams - ( like  rowOffset maxRows sort order)
                                                           * @param filters - array of filters )
      - countRows(filters = null)

      - in case you want to support inline edit you need to define 3 closures ( updateRow , saveRow ,delRow)
2) declare this service in Config.groovy , under easygrid.dataSourceImplementations




#### Columns section
The label of each column (displayed in the header )will be the actual name of the closure.

- Column Value:
For each column you have to define the value that will be displayed.
Currently there's 2 options. In case the type of the grid is "domain" or "list", and you just want do display a plain property you can use "property".

Otherwise you can use the "value" closure, whose first parameter will be the actual row, and it will return whatever you need.

(There is a possibility to define the "property" columns more compact by using the actual property as the name of the column ( the label will be generated using labelPrefix)

- Column view:
Another important section of each column is the javascript implementation section.
All the properties defined here except "searchClosure" will be available in the render template to be used in whatever way.

- "searchClosure" has a special treatment. It is a closure called after a search was made from the interface.
In case of grid type=domain, the search closure is actually a GORM CriteriaBuilder which will be passed to the list method of the domain.

#### Export
Easygrid also comes integrated with the export plugin. Basically, you can set export properties in the export section.

From the example you can also notice the "type" property of a column.
Types are defined in Config.groovy, and represent a collection of properties that will be applied to this column, to avoid duplicate settings.

Default values:
- all columns can have default values - which can be overriden


#### Formatters:
 - defined globally (Config.groovy) based on the type(class) of the value ( because - usually , applications, have global settings for displaying data . Ex: date format, Bigdecimal - no of decimals, etc.)

- formatters can also be defined per column

The format to apply to a value is chosen  this way:

1) with a formatClosure - provided at the column level
2) with a formatName - of a previously defined format
3) depending of the type of the value
4) the value ast it is


####  Security:

If you define the property securityProvider: then it will automatically guard all calls to the grid

Easygrid comes by default with a spring security implementation


#### Other grid properties:

You can customize every aspect of the grid - because everything is a property and can be overriden



Tablib:
-------------

Easygrid provies 2 taglibs:

- <grid:grid id="grid id"> - will render the taglib
- <grid:exportButton id="grid id"> - the export button


Testing:
---------------

- in each annotated controller, for each grid defined in "grids" , the plugin injects 3 methods:
                def ${gridName}Rows ()
                def ${gridName}Export ()
                def ${gridName}InlineEdit ()
- these can be tested in integration tests





How to :
----------

1)

2)


Example application
-------------------------

For a showcase application [please download](http://example.com/ "Title") .



Next features:
-----------------------

- other grid implementations ( like TreeGrid , Yui datatable)
- users should be able to select the columns they want to see ( & store these settings)


License
-------

Permission to use, copy, modify, and distribute this software for any
purpose with or without fee is hereby granted, provided that the above
copyright notice and this permission notice appear in all copies.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.